	LIST	P=16F84A
	
; REGITROS SFR
	
OP		EQU	01H
TMR0	EQU	01H
INTCON	EQU	0BH
STATUS	EQU	03H
PA		EQU	05H
TRISA	EQU	05H
PB		EQU	06H
TRISB	EQU	06H

;REGISTROS GFR

SEG			EQU	10H
VAR			EQU	11H


		ORG		0
		GOTO	PPAL


PPAL	ORG		30
		BSF		STATUS,5 		;CAMBIAR BANCO MEM 1
		CLRF	TRISA 			;PUERTO A DE SALIDA
		CLRF	TRISB			;PUERTO B DE SALIDA
		MOVLW	B'00000111'		;DIVISOR 256
		MOVWF	OP 				;DIVISOR 256
		BCF		STATUS,5 		;CAMBIO BANCO MEM 0
		
		MOVLW	B'10100000' 	;HABILITANDO LAS INTERRUPCIONES
		MOVWF	INTCON			;MOVIENDO EL VALOR DE 10100000 AL REGISTRO DE INTERRUPCIONES

		MOVLW 	D'25'
		MOVWF	SEG
		MOVLW	D'50'
		MOVWF	VAR
		MOVLW	D'178'
		MOVWF	TMR0
		
		;PRIMER SEMAFORO
		BSF		PA,0		;VERDE
		BCF		PA,1		;AMARILLO
		BCF		PA,2		;ROJO
		
		;SEGUNDO SEMAFORO
		BSF		PB,7		;ROJO
		BCF		PB,6		;AMARILLO
		BCF		PB,5		;VERDE

X1		NOP
		NOP
		NOP
		GOTO 	X1


		ORG		4
		GOTO	INTER

INTER	ORG		70
		DECFSZ	VAR,1	 ;VAR=VAR-1
		GOTO	E1
		DECFSZ	SEG,1    ;SEG=SEG-1
		GOTO	E2		 ;VAR DIF. CERO
		BTFSC	PA,0	 ;VERIFICAR SI VERDE PRIMER SEMAFORO ESTA ENCENDIDO
		GOTO	OFFV
		BTFSC	PA,1	 ;VERIFICAR SI AMARILLO PRIMER SEMAFORO ESTA ENCENDIDO
		GOTO	OFFA
		BTFSC	PB,5	 ;VERIFICAR SI VERDE SEGUNDO SEMAFORO ESTA ENCENDIDO
		GOTO	SEM2
		BTFSC	PA,2	 ;VERIFICAR SI ROJO PRIMER SEMAFORO ESTA ENCENDIDO
		GOTO	OFFR
		BSF		PA,0	;VERDE
		BCF		PA,1	;AMARILLO
		BCF		PA,2	;ROJO
		MOVLW	D'25'
		MOVWF	SEG
		GOTO	E2

;APAGAR EL LED VERDE PARA ENCENDER EL AMARILLO
OFFV	BCF		PA,0	;VERDE
		BSF		PA,1	;AMARILLO
		BCF		PA,2	;ROJO
		MOVLW	D'5'
		MOVWF	SEG
		GOTO	E2

;APAGAR EL LED AMARILLO PARA ENCENDER EL ROJO DEL PRIMER SEMAFORO
;ENCENDIENDO EL VERDE DEL SEGUNDO SEMAFORO
OFFA	BCF		PA,0	;VERDE
		BCF		PA,1	;AMARILLO
		BSF		PA,2	;ROJO
		BCF		PB,7	;ROJO
		BCF		PB,6	;AMARILLO
		BSF		PB,5	;VERDE
		MOVLW	D'25'
		MOVWF	SEG
		GOTO	E2

;APAGAR EL LED ROJO PARA ENCENDER EL VERDE DEL PRIMER SEMAFORO
;ENCENDIENDO EL ROJO DEL SEGUNDO SEMAFORO		
OFFR	BSF		PA,0	;VERDE
		BCF		PA,1	;AMARILLO (PUEDO ELIMINAR)
		BCF		PA,2	;ROJO
		BSF		PB,7	;ROJO
		BCF		PB,6	;AMARILLO
		BCF		PB,5	;VERDE (PUEDO ELIMINAR)
		MOVLW	D'25'
		MOVWF	SEG
		GOTO	E2

;REALIZAR EL CAMBIO ENTRE EL VERDE Y EL AMARILLO DEL SEGUNDO SEMAFORO
SEM2	BCF		PB,7	;ROJO (PUEDO ELIMINAR)
		BSF		PB,6	;AMARILLO
		BCF		PB,5	;VERDE
		MOVLW	D'5'
		MOVWF	SEG
	
;REINICIAR CICLO
E2		MOVLW	D'50'	;ASIGNAMOS 50 A VAR
		MOVWF	VAR		;VAR=W

E1		MOVLW	D'178'	;ASIGNAMOS 178 AL TMR0
		MOVWF	TMR0	;TMR0=W	
		BCF		INTCON,2;APAGO EL FLAG DE TMR0
		RETFIE	

	END
