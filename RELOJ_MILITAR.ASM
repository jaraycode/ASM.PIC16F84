        LIST P=16F84A

; Todas las variables relacionadas con sistema
PCL         EQU     02H;
STATUS      EQU     03H;
PA          EQU     05H;
TRISA       EQU     05H;    
PB          EQU     06H;
TRISB       EQU     06H;
OP          EQU     01H;
TMR0        EQU     01H;
INTCON      EQU     0BH;

; Variables para poder marcar los segundos
VAR         EQU     10H;
VAR2        EQU     11H;
VAR3        EQU     12H;
VAR4        EQU     13H;
VAR5        EQU     14H;
VAR6        EQU     15H;

        ORG     0; INICIO DE PROGRAMA
        GOTO    INICIO;

INICIO  ORG     10;
        BSF     STATUS,5; CAMBIO A BANCO DE MEMORIA 1, DONDE SE ASIGNAN LOS METADATOS
        CLRF    TRISA; SALIDA QUE AYUDO A CONTROLAR CUALES SON LOS DISPLAYS QUE SE VAN A PRENDER
        CLRF    TRISB; HACIENDO QUE EL PUERTO B, QUE TIENE MAYOR CANTIDAD DE SALIDAS, SEA EL ASIGNADO PARA GENERAR LOS NUMEROS
        MOVLW   B'00000110'; METO DENTRO DE LA VARIABLE W DEL SISTEMA EL VALOR DECIMAL QUE GENERA UN DIVISOR PARA LAS INTERRUPCIONES
        MOVWF   OP; LO MUEVO A LA VARIABLE DE CONTROL DE SISTEMA PARA GENERAR QUE EL TEMPORIZADOR FUNCIONE
        BCF     STATUS,5; REGRESO A BANCO DE MEMORIA 0, DONDE SE GENERA TODO EL CODIGO

        ; SALIDA BASE UNA VEZ DADA LA CORRIENTE AL CIRCUITO
        MOVLW   B'00001111'; opcion 1 // la opcion 2 sería b'01111111'
        MOVWF   PA

        ; ACTIVAR TODOS LOS PUERTOS
        MOVLW   B'10000000';
        MOVWF   PB

        CLRF    PA;

        ; ACTIVANDO LAS BANDERAS DE LAS INTERRUPCIONES
        MOVLW   B'10100000'
        MOVWF   INTCON

        ; RELACIONADO CON EL TEMPORIZADOR
        MOVLW   D'178'
        MOVWF   TMR0

        MOVLW   D'200'
        MOVWF   VAR; GARANTIZA QUE SE EJECUTE UN SEGUNDO CON LA CONFIGURACIÓN ESTABLECIDA POR EL OP Y TMR0

        MOVLW   D'60'
        MOVWF   VAR2; GARANTIZA QUE PASEN EXACTAMENTE 60 SEGUNDOS PARA CAMBIAR EL ESTADO

        MOVLW   D'9';
        MOVWF   VAR3;

; CICLO DE LOOP PARA QUE TRABAJE LA INTERRUPCIÓN
X1      NOP
        NOP
        GOTO    X1

        ORG     04; UNA VEZ REALIZADA LA INTERRUPCIÓN SUELE SALTAR A LA LINEA 4
        GOTO    TIME

TIME    ORG     50;
        DECFSZ  VAR,1; DECREMENTA EL VALOR DE VAR -1 Y CUANDO SEA 0 SALTA DE LINEA, PARA ESTE MOMENTO CUANDO HAGA EL SALTO DE LÍNEA DEBE HABER PASADO 1 SEGUNDO
        GOTO    X2
        DECFSZ  VAR2,1; SIMILAR AL ANTERIOR Y EN CASO DE QUE SALTE UNA LINEA SIGNIFICA QUE HABRÁ PASADO 1 MINUTO EXACTO
        GOTO    X3
        CALL    FIRST; SE DEJA EL ESPACIO PARA PODER REALIZAR LA LÓGICA DETRÁS DE LOS ESTADOS DEL RELOJ MILITAR
        


        MOVLW   D'60'
        MOVWF   VAR2

X3      MOVLW   D'200'
        MOVWF   VAR

X2      MOVLW   D'178'
        MOVWF   TMR0

        BCF     INTCON,2; APAGA LA BANDERA DE LA INTERRUPCIÓN PARA QUE LA MISMA SE PUEDA VOLVER A GENERAR
        RETFIE; ESTA PALABRA RESERVADA LO QUE HACE ES REGRESAR A LA LÍNEA DONDE SE GENERÓ LA INTERRUPCIÓN, EN ESTE CASO SERÍA EL TAG X1

; FUNCIONES PARA PODER DETERMINAR EL DISPLAY QUE SE VA A CAMBIAR
FIRST   MOVLW   B'00000001'
        MOVWF   PA
        ; MANERA PARA DETERMINAR QUE NUMERO VA A MOSTRAR
        DECFSZ  VAR3,1;
        GOTO    X4
        CALL    SECOND
X4      
        RETURN

SECOND  CALL    CERO
        MOVLW   D'9'
        MOVWF   VAR3
        MOVLW   B'00000010'
        MOVWF   PA
        DECFSZ  VAR4,1
        RETURN

THIRD   MOVLW   D'6'
        MOVWF   VAR4
        MOVLW   B'00000100'
        MOVWF   PA
        DECFSZ  VAR5,1
        RETURN 

FOURTH  MOVLW   D'9'
        MOVWF   VAR5
        MOVLW   B'00001000'
        MOVWF   PA
        DECFSZ  VAR6,1
        RETURN

RESET   MOVLW   B'00001111'
        MOVWF   PA
        MOVLW   B'10000000'
        MOVWF   PB

; FUNCIONES PARA ENCENDER CADA NUMERO
CERO    MOVLW   B'11000000'
        MOVWF   PB
        RETURN

ONE     MOVLW   B'11111001'
        MOVWF   PB
        RETURN

TWO     MOVLW   B'10100100'
        MOVWF   PB
        RETURN

THREE   MOVLW   B'10110000'
        MOVWF   PB
        RETURN

FOUR    MOVLW   B'10011001'
        MOVWF   PB
        RETURN

FIVE    MOVLW   B'10010010'
        MOVWF   PB
        RETURN

SIX     MOVLW   B'10000010'
        MOVWF   PB
        RETURN

SEVEN   MOVLW   B'11111000'
        MOVWF   PB
        RETURN

EIGHT   MOVLW   B'10000000'
        MOVWF   PB
        RETURN

NINE    MOVLW   B'10011000'
        MOVWF   PB
        RETURN


        END; FIN DE PROGRAMA
