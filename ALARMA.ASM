		LIST P=16F84A

;INTEGRANTES
;CESAR BAUTE CI: 30.032.199
;ORIANNA VANEGAS CI: 28.326.690
;JONAS ARAY CI: 29.611.454

;REGISTROS
STATUS		EQU		03H
TMR0		EQU		01H
OP			EQU		01H
INTCON		EQU		0BH
PA			EQU		05H
TRISA		EQU		05H
PB			EQU		06H
TRISB		EQU		06H

;REGISTROS VARIABLES
SEG			EQU		11H
VAR			EQU		12H
BUTTON		EQU		13H
PASS		EQU		14H
DOORC		EQU		16H

	ORG		0; INICIO DE PROGRAMA
	GOTO	INICIO
;CONTRASEÑA 1111
INICIO	ORG	20;
		BSF		STATUS,5		;BANCO DE MEMORIA 0
		MOVLW	B'00011100'		;ASIGNANDO LOS SWITCHES
		MOVWF	TRISA
		MOVLW	B'00101111'		;VALORES PARA EL DIP Y PARA EL BOTÓN
		MOVWF	TRISB
		MOVLW	B'00000111'		;DIVISOR 256
		MOVWF	OP
		BCF		STATUS,5		;BANCO DE MEMORIA 1
		BCF		PA,0			;ASEGURANDO QUE EL LED DE ALARMA ESTÉ APAGADO
		MOVLW	B'00000000'
		MOVWF	DOORC
		MOVLW	B'00001111'		;CONTRASEÑA
		MOVWF	PASS
;CICLO DONDE SE GENERA LA INTERRUPCIÓN
R1		CALL	SWITCH1
		CALL	SWITCH2
		CALL	SWITCH3
		GOTO	R1		

SWITCH1	BTFSS	PA,2	;PUERTA ABIERTA
		GOTO	A		;SE VERIFICA QUE LA PUERTA YA HA SIDO CERRADA
		BTFSC	DOORC,0 ;VERIFICACION DE PUERTA CERRADA
		CALL 	TIEMPO  ;COMIENZA LA INTERRUPCION
		RETURN

A		MOVLW	B'00000001'
		MOVWF	DOORC
		RETURN
;VALORES DE INTERRUPCION, MAS REINICIO DE LA PUERTA CERRADA
TIEMPO	MOVLW	B'00000000'
		MOVWF	DOORC
		MOVLW	B'10100000'
		MOVWF	INTCON
		MOVLW	D'246'
		MOVWF	TMR0
		MOVLW	D'100'
		MOVWF	VAR
		MOVLW	D'10'
		MOVWF	SEG
		BSF		PA,1
		RETURN
;PRENDER ALARMA, ACCESO ILEGAL
SWITCH2	BTFSS	PA,3
		RETURN
		CALL	ALARMA
		RETURN
;PRENDER ALARMA, ACCESO ILEGAL
SWITCH3	BTFSS	PA,4
		RETURN
		CALL	ALARMA
		RETURN

		ORG 	4;
		GOTO	INTE
;INTERRUPCION
INTE	ORG		80;
		CALL	BOTON
		DECFSZ	VAR,1;
		GOTO	E1
		DECFSZ	SEG,1;
		GOTO	E2
		CALL	ALARMA
;VERIFICACION DE CONTRASEÑA
BOTON	BTFSC	PB,5
		RETURN
		BTFSS	PB,0
		RETURN
		BTFSS	PB,1
		RETURN
		BTFSS	PB,2
		RETURN
		BTFSS	PB,3
		RETURN
		CALL	FIN		
		RETURN
;EN CASO DE CONTRASEÑA CORRECTA, APAGA INTERRUPCION Y REINICIA PUERTA
FIN		CLRF	INTCON
		BCF		PA,1
		MOVLW	B'00000000'
		MOVWF	DOORC
		RETURN
;ENCENDER ALARMA
ALARMA	BCF		PA,1
		BSF		PA,0
		RETURN
;REINICIAR TIMER			
E2		MOVLW	D'100'
		MOVWF	VAR
E1		MOVLW	D'246'
		MOVWF	TMR0

		BCF		INTCON,2
		RETFIE
		END
		

		